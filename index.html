<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eva Alem√°n - K-Pop Hunters World Tour</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Archivo+Black&family=Archivo:wght@300;500;900&display=swap');
        
        :root {
            --kpop-pink: #ec4899;
            --kpop-purple: #7c3aed;
        }

        body { 
            font-family: 'Archivo Black', sans-serif; 
            background-color: #000;
            color: white;
            margin: 0;
            overflow-x: hidden;
        }

        .font-archivo { font-family: 'Archivo', sans-serif; }
        
        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .animate-marquee {
            display: inline-flex;
            animation: marquee 25s linear infinite;
        }

        .glass-card {
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(12px);
            border: 4px solid rgba(255, 255, 255, 0.1);
        }

        .btn-action {
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
            cursor: pointer;
        }

        .btn-action:active {
            transform: scale(0.95);
        }

        .shadow-kpop {
            box-shadow: 0 0 40px rgba(236, 72, 153, 0.4);
        }
    </style>
</head>
<body>
    <!-- FONDO DE PANTALLA -->
    <div class="fixed inset-0 z-0 bg-cover bg-center" style="background-image: url('https://images.tcdn.com.br/img/img_prod/1129828/k_pop_hunters_volume_1_e_2_3127_1_15d868953923485f762744d567118833.jpg')"></div>
    <div id="bg-overlay" class="fixed inset-0 z-0 backdrop-blur-[4px] bg-black/75 transition-colors duration-700"></div>

    <div id="app-root" class="relative z-10 min-h-screen pb-20">
        <!-- Loader inicial -->
        <div class="flex flex-col items-center justify-center h-screen gap-6">
            <div class="animate-spin rounded-full h-24 w-24 border-t-4 border-pink-500"></div>
            <p class="text-2xl font-black italic animate-pulse text-pink-500">CONECTANDO AL TOUR...</p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        // CONFIGURACI√ìN REAL DE TUS FOTOS
        const firebaseConfig = {
            apiKey: "AIzaSyBE3mn9a-hgJjr3zRI_fftNfI4jfrCllQc",
            authDomain: "eva-kpop-tour.firebaseapp.com",
            projectId: "eva-kpop-tour",
            storageBucket: "eva-kpop-tour.firebasestorage.app",
            messagingSenderId: "49327968177",
            appId: "1:49327968177:web:647c232224aa288f3c7790"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = 'eva-kpop-tour-prod'; // ID √∫nico para tu base de datos

        window.KPopApp = {
            state: {
                taskPoints: {},
                history: {},
                user: null,
                viewingDate: null,
                today: new Date().toISOString().split('T')[0]
            },

            tasks: [
                { id: 'h1', label: 'Hacer la cama', emoji: 'üõèÔ∏è', max: 1 },
                { id: 'h2', label: 'Dientes (x6)', emoji: 'ü™•', max: 6 },
                { id: 'h3', label: 'Dormir sola', emoji: 'üåô', max: 1 },
                { id: 'h4', label: 'Ba√±arse sola', emoji: 'üöø', max: 1 },
                { id: 'h5', label: 'Vestirse sola', emoji: 'üëó', max: 1 },
                { id: 'h6', label: 'Espacio ordenado', emoji: 'üß∏', max: 1 },
                { id: 'h7', label: 'Crear algo', emoji: 'üé®', max: 4 },
                { id: 'h8', label: 'Leer', emoji: 'üìö', max: 5 },
                { id: 'h9', label: 'Tarea', emoji: 'üìù', max: 10 },
                { id: 's1', label: 'Balance con comida', emoji: 'üçé', max: 5 },
                { id: 's2', label: 'Tiempo de pantalla', emoji: 'üì±', max: 5 },
                { id: 'v1', label: 'No enga√±ar', emoji: 'üòá', max: 30 },
                { id: 'v2', label: 'No gritar', emoji: 'ü§´', max: 10 },
                { id: 'v3', label: 'Respetar a mayores', emoji: 'ü§ù', max: 20 }
            ],

            async init() {
                onAuthStateChanged(auth, async (user) => {
                    if (!user) {
                        try {
                            await signInAnonymously(auth);
                        } catch (e) {
                            console.error("Error Auth:", e);
                            document.getElementById('app-root').innerHTML = `<div class="p-10 text-center text-red-500 font-black">ERROR: ACTIVA ACCESO AN√ìNIMO EN FIREBASE</div>`;
                            return;
                        }
                    }
                    this.state.user = auth.currentUser;
                    this.syncData();
                });
            },

            syncData() {
                // Escuchar puntos de hoy
                onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'daily', this.state.today), (snap) => {
                    if (snap.exists()) {
                        this.state.taskPoints = snap.data().points || {};
                    } else {
                        this.state.taskPoints = {};
                    }
                    this.render();
                });

                // Escuchar historial completo para el total mensual
                onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'history'), (snap) => {
                    const newHistory = {};
                    snap.forEach(doc => { newHistory[doc.id] = doc.data(); });
                    this.state.history = newHistory;
                    this.render();
                });
            },

            async updatePoints(taskId, delta, max) {
                if (this.state.viewingDate && this.state.viewingDate !== this.state.today) return;
                
                const current = (this.state.taskPoints[taskId] || 0);
                let next = current + delta;
                
                if (max && next > max) next = max;
                if (next < -100) next = -100;

                this.state.taskPoints[taskId] = next;
                const total = Object.values(this.state.taskPoints).reduce((a, b) => a + (b || 0), 0);

                try {
                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'daily', this.state.today), {
                        points: this.state.taskPoints,
                        total: total,
                        updatedAt: new Date().toISOString()
                    });
                } catch (e) { console.error("Error guardando:", e); }
            },

            async saveDay() {
                const total = Object.values(this.state.taskPoints).reduce((a, b) => a + (b || 0), 0);
                if (total === 0 && !confirm("¬øCerrar show con 0 puntos?")) return;

                try {
                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'history', this.state.today), {
                        total,
                        details: { ...this.state.taskPoints },
                        timestamp: new Date().toISOString()
                    });
                    alert("‚ú® ¬°SHOW COMPLETADO! Los puntos se han guardado en el historial del tour.");
                } catch (e) { console.error("Error al cerrar:", e); }
            },

            render() {
                const root = document.getElementById('app-root');
                if (!root) return;

                const activeDateStr = this.state.viewingDate || this.state.today;
                const isHistory = activeDateStr !== this.state.today;
                
                const activePoints = isHistory ? (this.state.history[activeDateStr]?.details || {}) : this.state.taskPoints;
                const currentTotal = Object.values(activePoints).reduce((a, b) => a + (typeof b === 'number' ? b : 0), 0);
                const monthlyTotal = Object.values(this.state.history).reduce((a, b) => a + (b.total || 0), 0);
                const money = monthlyTotal * 100;

                root.innerHTML = this.template(currentTotal, monthlyTotal, money, activePoints, isHistory, activeDateStr);
                if (window.lucide) window.lucide.createIcons();
            },

            template(current, monthly, money, points, isHistory, activeDateStr) {
                const dayNum = activeDateStr.split('-')[2];
                
                return `
                    <!-- MARQUESINA SUPERIOR -->
                    <div class="relative z-20 w-full border-y-4 border-white py-4 overflow-hidden shadow-2xl transition-colors ${isHistory ? 'bg-indigo-600' : 'bg-pink-600'}">
                        <div class="animate-marquee">
                            ${Array(10).fill(`<span class="text-4xl font-black italic uppercase tracking-tighter mx-8 flex items-center gap-4 text-white">
                                <i data-lucide="${isHistory ? 'history' : 'zap'}"></i> ${isHistory ? 'REVISANDO SHOW PASADO' : 'EVA ALEM√ÅN K-POP TOUR'} <i data-lucide="star" class="fill-white text-white"></i>
                            </span>`).join('')}
                        </div>
                    </div>

                    <div class="p-4 md:p-12 max-w-[1400px] mx-auto">
                        <div class="text-center mb-12 mt-4 relative">
                            ${isHistory ? `
                                <button onclick="window.KPopApp.state.viewingDate = null; window.KPopApp.render()" 
                                    class="absolute left-0 top-1/2 -translate-y-1/2 bg-white text-black px-6 py-3 rounded-full font-black flex items-center gap-2 hover:scale-110 transition-transform shadow-xl z-50">
                                    <i data-lucide="arrow-left"></i> VOLVER
                                </button>` : ''}
                            <h1 class="text-7xl md:text-9xl font-black italic tracking-tighter leading-none uppercase text-white drop-shadow-[0_0_30px_rgba(236,72,153,0.8)]">
                                ${isHistory ? 'RECUERDO' : 'EVA ALEM√ÅN'}
                            </h1>
                            <p class="text-xl font-black tracking-[0.5em] text-pink-400 uppercase italic">
                                D√çA DEL TOUR: ${dayNum}
                            </p>
                        </div>

                        <!-- DASHBOARD DE PUNTOS Y DINERO -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-16">
                            <section class="glass-card rounded-[3rem] p-8 border-4 ${isHistory ? 'border-indigo-400' : 'border-pink-500 shadow-kpop'}">
                                <div class="flex items-center gap-4 mb-6 border-b border-white/10 pb-4">
                                    <i data-lucide="crown" class="text-yellow-400"></i>
                                    <h2 class="text-4xl font-black uppercase italic tracking-tighter">PUNTOS</h2>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-white/5 p-6 rounded-[2rem] text-center border border-white/10">
                                        <p class="text-[10px] font-black text-pink-400 uppercase">Hoy</p>
                                        <p class="text-6xl font-black">${current}</p>
                                    </div>
                                    <div class="bg-pink-600 p-6 rounded-[2rem] text-center shadow-lg">
                                        <p class="text-[10px] font-black text-white/70 uppercase">Acumulado</p>
                                        <p class="text-6xl font-black">${monthly}</p>
                                    </div>
                                </div>
                            </section>

                            <section class="bg-gradient-to-br from-indigo-900 via-purple-900 to-black rounded-[3rem] p-8 shadow-2xl border-4 border-indigo-500">
                                <div class="flex items-center gap-4 mb-6 border-b border-indigo-500/30 pb-4">
                                    <i data-lucide="trophy" class="text-yellow-400"></i>
                                    <h2 class="text-4xl font-black uppercase italic tracking-tighter text-white">GANANCIAS</h2>
                                </div>
                                <div class="text-center mb-6">
                                    <p class="text-7xl font-black text-white tracking-tighter">$${money.toLocaleString('es-CL')}</p>
                                </div>
                                <div class="grid grid-cols-3 gap-3">
                                    <div class="bg-black/40 p-3 rounded-2xl text-center border border-white/10">
                                        <p class="text-[9px] font-black text-pink-300">GASTOS</p>
                                        <p class="text-sm font-black">$${(money * 0.5).toLocaleString('es-CL')}</p>
                                    </div>
                                    <div class="bg-black/40 p-3 rounded-2xl text-center border border-white/10">
                                        <p class="text-[9px] font-black text-blue-300">AHORRO</p>
                                        <p class="text-sm font-black">$${(money * 0.4).toLocaleString('es-CL')}</p>
                                    </div>
                                    <div class="bg-black/40 p-3 rounded-2xl text-center border border-white/10">
                                        <p class="text-[9px] font-black text-yellow-300">REGALO</p>
                                        <p class="text-sm font-black">$${(money * 0.1).toLocaleString('es-CL')}</p>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <!-- LISTA DE TAREAS -->
                        <section class="mb-16">
                            <h2 class="text-5xl font-black uppercase italic tracking-tighter mb-8 text-white">
                                SETLIST DIARIO
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${this.tasks.map(t => {
                                    const p = points[t.id] || 0;
                                    const isMaxed = p >= t.max && t.max > 0;
                                    return `
                                        <div class="p-6 rounded-[2.5rem] border-2 transition-all ${isMaxed ? 'bg-pink-600 border-white shadow-lg' : 'bg-black/60 border-white/10'}">
                                            <div class="flex justify-between items-center">
                                                <div class="flex items-center gap-4">
                                                    <span class="text-5xl drop-shadow-lg">${t.emoji}</span>
                                                    <h3 class="font-black text-xl uppercase italic leading-tight">${t.label}</h3>
                                                </div>
                                                <div class="flex items-center gap-3">
                                                    ${!isHistory ? `<button onclick="window.KPopApp.updatePoints('${t.id}', 1, ${t.max})" class="btn-action w-12 h-12 bg-yellow-400 text-black rounded-full font-black text-2xl shadow-md">+</button>` : ''}
                                                    <span class="text-3xl font-black w-8 text-center">${p}</span>
                                                    ${!isHistory ? `<button onclick="window.KPopApp.updatePoints('${t.id}', -1, ${t.max})" class="btn-action w-8 h-8 bg-white/10 rounded-full font-black text-sm">-</button>` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </section>

                        <!-- BOTONES DE DISCIPLINA -->
                        ${!isHistory ? `
                        <div class="grid grid-cols-2 gap-6 mb-16">
                            <button onclick="window.KPopApp.updatePoints('penalty', -5, 0)" class="btn-action bg-red-600 p-8 rounded-[2.5rem] flex justify-between items-center border-b-4 border-red-900">
                                <span class="font-black text-2xl italic">FALTA</span>
                                <span class="text-5xl font-black">-5</span>
                            </button>
                            <button onclick="window.KPopApp.updatePoints('bonus', 2, 100)" class="btn-action bg-yellow-400 text-black p-8 rounded-[2.5rem] flex justify-between items-center border-b-4 border-yellow-600">
                                <span class="font-black text-2xl italic">STAR</span>
                                <span class="text-5xl font-black">+2</span>
                            </button>
                        </div>

                        <button onclick="window.KPopApp.saveDay()" class="btn-action w-full bg-pink-600 p-10 rounded-[3rem] font-black text-5xl uppercase italic tracking-tighter text-white border-4 border-white shadow-kpop mb-16">
                            CERRAR SHOW
                        </button>` : ''}

                        <!-- CALENDARIO -->
                        <section class="bg-black/80 p-8 rounded-[3rem] border-2 border-pink-500/30 mb-10">
                            <h2 class="text-3xl font-black uppercase italic mb-6 flex items-center gap-3">
                                <i data-lucide="calendar"></i> TOUR MAP
                            </h2>
                            <div class="grid grid-cols-7 gap-2">
                                ${Array.from({length: 31}, (_, i) => {
                                    const day = i + 1;
                                    const dKey = `${this.state.today.substring(0, 8)}${String(day).padStart(2, '0')}`;
                                    const hasData = this.state.history[dKey];
                                    const isToday = dKey === this.state.today;
                                    const isSelected = this.state.viewingDate === dKey;

                                    return `
                                        <button onclick="if('${hasData || isToday}' === 'true') { window.KPopApp.state.viewingDate = '${dKey}'; window.KPopApp.render(); }"
                                            class="aspect-square flex flex-col items-center justify-center rounded-xl transition-all border
                                            ${isSelected ? 'bg-yellow-400 text-black border-white scale-110 z-10' : 
                                              isToday ? 'bg-white text-black border-pink-500' :
                                              hasData ? 'bg-white/10 border-pink-500/40 text-white' : 'bg-white/5 border-transparent opacity-20'}">
                                            <span class="text-lg font-black">${day}</span>
                                            ${hasData ? `<div class="text-[8px] font-black">${hasData.total}</div>` : ''}
                                        </button>
                                    `;
                                }).join('')}
                            </div>
                        </section>
                    </div>
                `;
            }
        };

        window.onload = () => window.KPopApp.init();
    </script>
</body>
</html>
