<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eva K-Pop Tour - LIVE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Archivo+Black&family=Archivo:wght@300;500;900&display=swap');
        body { font-family: 'Archivo Black', sans-serif; background-color: #000; color: white; margin: 0; overflow-x: hidden; }
        .glass-card { background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px); border: 2px solid rgba(255, 255, 255, 0.1); }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        .animate-marquee { display: inline-flex; animation: marquee 20s linear infinite; }
    </style>
</head>
<body>
    <!-- Fondo y Overlay -->
    <div class="fixed inset-0 z-0 bg-cover bg-center" style="background-image: url('https://images.tcdn.com.br/img/img_prod/1129828/k_pop_hunters_volume_1_e_2_3127_1_15d868953923485f762744d567118833.jpg')"></div>
    <div class="fixed inset-0 z-0 bg-black/70 backdrop-blur-[2px]"></div>

    <div id="app" class="relative z-10 min-h-screen pb-10">
        <!-- Pantalla de Carga -->
        <div id="loading" class="flex flex-col items-center justify-center h-screen">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-pink-500 mb-4"></div>
            <p class="text-pink-500 font-black animate-pulse uppercase">Iniciando Gira Mundial...</p>
        </div>

        <!-- Contenido de la App (se llena con JS) -->
        <div id="content" class="hidden">
            <div class="w-full bg-pink-600 border-y-2 border-white py-2 overflow-hidden mb-6">
                <div class="animate-marquee whitespace-nowrap">
                    <span class="mx-4 text-xl italic font-black">EVA K-POP TOUR 2026 ‚Ä¢ SHOW TIME ‚Ä¢ </span>
                    <span class="mx-4 text-xl italic font-black">EVA K-POP TOUR 2026 ‚Ä¢ SHOW TIME ‚Ä¢ </span>
                    <span class="mx-4 text-xl italic font-black">EVA K-POP TOUR 2026 ‚Ä¢ SHOW TIME ‚Ä¢ </span>
                </div>
            </div>

            <div class="px-4 max-w-md mx-auto">
                <div class="text-center mb-6">
                    <h1 class="text-5xl font-black italic uppercase tracking-tighter">EVA ALEM√ÅN</h1>
                    <p id="current-date" class="text-pink-400 font-bold text-sm uppercase tracking-widest"></p>
                </div>

                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div class="glass-card p-4 rounded-2xl text-center border-pink-500/30">
                        <p class="text-[10px] font-bold text-pink-400 uppercase">Puntos Hoy</p>
                        <p id="score-today" class="text-5xl font-black">0</p>
                    </div>
                    <div class="bg-pink-600 p-4 rounded-2xl text-center shadow-lg">
                        <p class="text-[10px] font-bold text-white/70 uppercase">Total Mes</p>
                        <p id="score-month" class="text-5xl font-black">0</p>
                    </div>
                </div>

                <div id="task-list" class="space-y-3">
                    <!-- Las tareas se generar√°n aqu√≠ -->
                </div>

                <button id="btn-save" class="w-full mt-8 bg-white text-black p-5 rounded-2xl font-black text-2xl uppercase italic border-b-4 border-gray-400 active:translate-y-1 active:border-b-0 transition-all">
                    Cerrar Show
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, getDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        // Tus credenciales reales de la captura
        const firebaseConfig = {
            apiKey: "AIzaSyBE3mn9a-hgJjr3zRI_fftNfI4jfrCllQc",
            authDomain: "eva-kpop-tour.firebaseapp.com",
            projectId: "eva-kpop-tour",
            storageBucket: "eva-kpop-tour.firebasestorage.app",
            messagingSenderId: "49327968177",
            appId: "1:49327968177:web:647c232224aa288f3c7790"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = 'eva-kpop-app-v1';

        const tasks = [
            { id: 'h1', label: 'Hacer la cama', emoji: 'üõèÔ∏è', max: 1 },
            { id: 'h2', label: 'Dientes (x6)', emoji: 'ü™•', max: 6 },
            { id: 'h3', label: 'Dormir sola', emoji: 'üåô', max: 1 },
            { id: 'h4', label: 'Ba√±arse sola', emoji: 'üöø', max: 1 },
            { id: 'v1', label: 'No enga√±ar', emoji: 'üòá', max: 30 },
            { id: 'v2', label: 'No gritar', emoji: 'ü§´', max: 10 },
            { id: 'v3', label: 'Respetar', emoji: 'ü§ù', max: 20 }
        ];

        let currentPoints = {};
        let monthlyTotal = 0;
        const todayKey = new Date().toISOString().split('T')[0];

        // Inicializar Auth
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                await signInAnonymously(auth);
            } else {
                startApp();
            }
        });

        function startApp() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
            document.getElementById('current-date').innerText = new Date().toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' });

            // Escuchar puntos de hoy
            onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'daily', todayKey), (snap) => {
                currentPoints = snap.exists() ? snap.data().points : {};
                renderTasks();
            });

            // Escuchar historial para el total del mes
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'history'), (snap) => {
                monthlyTotal = 0;
                snap.forEach(d => monthlyTotal += (d.data().total || 0));
                document.getElementById('score-month').innerText = monthlyTotal;
            });
        }

        async function updatePoints(id, delta, max) {
            const val = (currentPoints[id] || 0) + delta;
            if (val < 0 || (max && val > max)) return;
            
            currentPoints[id] = val;
            const total = Object.values(currentPoints).reduce((a, b) => a + b, 0);
            
            await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'daily', todayKey), {
                points: currentPoints,
                total: total,
                updatedAt: new Date().toISOString()
            });
        }

        window.saveDay = async () => {
            const total = Object.values(currentPoints).reduce((a, b) => a + b, 0);
            await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'history', todayKey), {
                total: total,
                details: currentPoints,
                timestamp: new Date().toISOString()
            });
            alert("¬°Show guardado en el historial!");
        };

        function renderTasks() {
            const list = document.getElementById('task-list');
            const total = Object.values(currentPoints).reduce((a, b) => a + b, 0);
            document.getElementById('score-today').innerText = total;

            list.innerHTML = tasks.map(t => {
                const p = currentPoints[t.id] || 0;
                const isDone = p >= t.max && t.max > 0;
                return `
                    <div class="glass-card p-4 rounded-2xl flex justify-between items-center border-l-4 ${isDone ? 'border-green-400' : 'border-pink-500'}">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">${t.emoji}</span>
                            <span class="font-bold text-sm uppercase">${t.label}</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="updatePoints('${t.id}', 1, ${t.max})" class="w-10 h-10 bg-pink-600 rounded-full font-black text-xl shadow-lg">+</button>
                            <span class="font-black text-xl w-6 text-center">${p}</span>
                            <button onclick="updatePoints('${t.id}', -1, ${t.max})" class="w-8 h-8 bg-white/10 rounded-full font-black text-sm opacity-50">-</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        window.updatePoints = updatePoints;
        document.getElementById('btn-save').onclick = window.saveDay;
    </script>
</body>
</html>
